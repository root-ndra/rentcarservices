<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIJA NIAINA CAR SERVICES</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="script.js" defer></script>
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">

<a href="tel:+261388552432" class="floating-call-btn" id="call-btn-link">
    <i class="fas fa-phone-alt"></i>
    <span>Appeler</span>
</a>

<nav class="navbar">
    <div class="logo-container">
        <img src="" alt="Logo" class="nav-logo" id="header-logo">
        <span id="header-site-name">CHARGEMENT...</span>
    </div>
    
    <button class="menu-toggle" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <ul class="nav-links" id="nav-menu">
        <li><a href="#" onclick="naviguerVers('home')" class="active">Accueil</a></li>
        <li><a href="#" onclick="naviguerVers('flotte')">Nos Voitures</a></li>
        <li><a href="#" onclick="naviguerVers('divertissement')">Divertissement</a></li>
        <li><a href="#" onclick="naviguerVers('contact')">Contact & Avis</a></li>
    </ul>
</nav>

<main style="flex: 1;">
    
    <section id="home" class="page-section">
        <div class="hero-banner">
            <h1 id="hero-title">Rija NIAINA Car Services</h1>
            <p class="hero-description">
                Chaque d√©placement est pens√© avec exigence et attention.
				√Ä Antananarivo, nous vous proposons des solutions de location de v√©hicules alliant confort, fiabilit√© et discr√©tion.
            </p>
            <button onclick="naviguerVers('flotte')" class="btn-hero">D√©couvrir notre flotte <i class="fas fa-arrow-right"></i></button>
        </div>

        <div id="pub-home_top" class="ad-container"></div>
        
        <h2 style="text-align:center; color:white; margin-bottom:30px;">Pourquoi nous choisir ?</h2>
        <div class="features-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <span class="feature-emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <h3>Famille</h3>
                        <small>(Cliquez ici)</small>
                    </div>
                    <div class="flip-card-back">
                        <p>Des v√©hicules spacieux pour le confort de toute votre famille lors de vos vacances.</p>
                    </div>
                </div>
            </div>

            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <span class="feature-emoji">üíº</span>
                        <h3>Affaires</h3>
                        <small>(Cliquez ici)</small>
                    </div>
                    <div class="flip-card-back">
                        <p>Berlines √©l√©gantes et discr√®tes pour vos rendez-vous professionnels.</p>
                    </div>
                </div>
            </div>

            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <span class="feature-emoji">üå¥</span>
                        <h3>√âvasion</h3>
                        <small>(Cliquez ici)</small>
                    </div>
                    <div class="flip-card-back">
                        <p>4x4 robustes pr√™ts √† affronter toutes les routes de Madagascar.</p>
                    </div>
                </div>
            </div>

            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <span class="feature-emoji">‚ÜîÔ∏è</span>
                        <h3>Flexibilit√©</h3>
                        <small>(Cliquez ici)</small>
                    </div>
                    <div class="flip-card-back">
                        <p>Horaires adapt√©s, options modulables et service sur mesure.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="pub-home_bot" class="ad-container"></div>
    </section>

    <section id="flotte" class="page-section" style="display:none;">
        <h2 class="section-title">Notre Collection</h2>
        <div id="pub-flotte_top" class="ad-container"></div>
        <div class="grid-voitures" id="container-voitures">
            <p>Chargement du catalogue...</p>
        </div>
        <div id="pub-flotte_bot" class="ad-container"></div>
    </section>

    <section id="reservation" class="page-section" style="display:none;">
        <button onclick="naviguerVers('flotte')" class="btn-back"><i class="fas fa-arrow-left"></i> Retour aux voitures</button>
        
        <div class="container-form">
            <h2>R√©servation : <span id="nom-voiture-selectionnee" class="highlight-text"></span></h2>
            
            <p id="desc-voiture-selectionnee" style="color: #666; font-style: italic; margin-bottom: 20px;"></p>

            <input type="hidden" id="id-voiture-input">
            <input type="hidden" id="ref-voiture-input">
            <input type="hidden" id="prix-base-input">

            <div id="wrapper-calendrier-global">
                <div class="bloc-calendrier">
                    <h3><i class="far fa-calendar-alt"></i> 1. Disponibilit√©s</h3>
                    
                    <button type="button" onclick="toggleCalendarVisibility()" class="btn-toggle-cal">
                        <i class="fas fa-eye"></i> Afficher/Masquer le calendrier
                    </button>
                    <div id="wrapper-calendrier" style="display:none; margin-bottom:15px;">
                        <div id="calendrier-dispo"></div>
                    </div>
                </div>
                <hr style="margin: 30px 0; border:0; border-top:1px solid #eee;">
            </div>

            <div class="dates-section">
                 <h3><i class="fas fa-clock"></i> Dates</h3>
                 <div class="dates-inputs" style="display:flex; gap:10px;">
                    <div style="flex:1;"><label>Du :</label><input type="date" id="date-debut" onchange="calculerPrix()"></div>
                    <div style="flex:1;"><label>Au :</label><input type="date" id="date-fin" onchange="calculerPrix()"></div>
                </div>
            </div>

            <hr style="margin: 30px 0; border:0; border-top:1px solid #eee;">
            
            <div class="section-logistique">
                 <h3><i class="fas fa-map-marker-alt"></i> 2. Logistique & Trajet</h3>
                 <div class="grid-form">
                     <div>
                         <label><strong>Livraison (D√©part)</strong></label>
                         <input type="text" id="lieu-livraison" placeholder="Lieu de livraison (ex: A√©roport, H√¥tel...)">
                         <input type="time" id="heure-livraison">
                     </div>
                     <div>
                         <label><strong>R√©cup√©ration (Retour)</strong></label>
                         <input type="text" id="lieu-recuperation" placeholder="Lieu de r√©cup√©ration">
                         <input type="time" id="heure-recuperation">
                     </div>
                 </div>
                 
                 <label style="margin-top:15px; display:block;"><strong>Trajet Pr√©vu (D√©claratif)</strong></label>
                 <small style="color:#666; display:block; margin-bottom:5px;">Veuillez indiquer les grandes √©tapes de votre d√©placement.</small>
                 <input type="text" id="trajet-1" placeholder="√âtape 1 (ex: Tana -> Antsirabe)">
                 <input type="text" id="trajet-2" placeholder="√âtape 2 (ex: Antsirabe -> Morondava)">
                 <input type="text" id="trajet-3" placeholder="√âtape 3 (ex: Retour Tana)">
            </div>

            <hr style="margin: 30px 0; border:0; border-top:1px solid #eee;">

            <div class="section-offres">
                <h3><i class="fas fa-sliders-h"></i> 3. Options de Location</h3>
                <div class="options-grid">
                    <label><input type="radio" name="offre" value="jour" class="hidden-input" checked onchange="calculerPrix()"><div class="btn-option"><i class="fas fa-sun"></i><span>Journ√©e</span><span class="option-price">7h - 19h</span></div></label>
                    <label><input type="radio" name="offre" value="nuit" class="hidden-input" onchange="calculerPrix()"><div class="btn-option"><i class="fas fa-moon"></i><span>Nuit</span><span class="option-price">19h - 7h</span></div></label>
                    <label><input type="radio" name="offre" value="24h" class="hidden-input" onchange="calculerPrix()"><div class="btn-option"><i class="fas fa-clock"></i><span>24H</span><span class="option-price">Jour + Nuit</span></div></label>
                </div>
                <div class="options-grid">
                    <label><input type="checkbox" id="opt-livraison" class="hidden-input" onchange="calculerPrix()"><div class="btn-option"><i class="fas fa-truck"></i><span>Livraison</span><span class="option-price">+15.000 Ar</span></div></label>
                    <label><input type="checkbox" id="opt-recuperation" class="hidden-input" onchange="calculerPrix()"><div class="btn-option"><i class="fas fa-undo"></i><span>R√©cup√©ration</span><span class="option-price">+15.000 Ar</span></div></label>
                </div>
                <label style="font-weight:600; color:#555;">Code promo ?</label>
                <div class="promo-container">
                    <input type="text" id="code-promo" placeholder="Code">
                    <button onclick="verifierPromo()" class="btn-dark" style="padding:10px 20px;">OK</button>
                </div>
                <span id="msg-promo" style="font-size:0.9rem; font-weight:bold; margin-top:5px; display:block;"></span>
            </div>

            <hr style="margin: 30px 0; border:0; border-top:1px solid #eee;">

            <div class="grid-form">
                <div class="col-form">
                    <h3><i class="fas fa-user"></i> 4. Vos Coordonn√©es</h3>
                    <input type="text" id="loueur-nom" placeholder="Nom complet">
                    <input type="text" id="loueur-prenom" placeholder="Pr√©nom">
                    <input type="text" id="loueur-adresse" placeholder="Adresse de r√©sidence">
                    <input type="tel" id="loueur-tel" placeholder="T√©l√©phone / WhatsApp">
                    <input type="text" id="loueur-cin" placeholder="N¬∞ CIN / Passeport / Permis">
                </div>
                <div class="col-form">
                    <h3><i class="fas fa-phone-alt"></i> Contact d'Urgence</h3>
                    <input type="text" id="urgence-nom" placeholder="Nom du contact">
                    <input type="text" id="urgence-adresse" placeholder="Adresse du contact">
                    <input type="tel" id="urgence-tel" placeholder="T√©l√©phone du contact">
                </div>
            </div>

            <div id="resume-prix" class="resume-box">
                <h3 style="margin-top:0; color:white; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px;">R√©capitulatif Financier</h3>
                <p>Dur√©e : <span id="txt-jours" style="font-weight:bold;">0</span> jours</p>
                <p>Formule : <span id="txt-formule" style="font-weight:bold;">JOUR</span></p>
                <p style="font-size:1.4rem; font-weight:bold; margin:10px 0;">Total : <span id="prix-total">0</span> Ar</p>
                <p style="color:#3498db; font-weight:bold;">Acompte requis (50%) : <span id="prix-acompte">0</span> Ar</p>
            </div>

            <div class="conditions-box" style="margin: 20px 0; background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba;">
                <label class="checkbox-container">
                    <input type="checkbox" id="check-conditions-step1">
                    J'ai lu et j'accepte les conditions g√©n√©rales de location.
                </label>
                <div style="margin-left: 35px;">
                    <a href="#" onclick="ouvrirModalConditions()" style="text-decoration: underline; color: #333;">Lire les conditions</a>
                </div>
            </div>

            <div id="step-1-actions" class="actions">
                <button id="btn-pre-resa" onclick="lancerReservationWhatsApp()" class="btn-whatsapp">
                    <i class="fab fa-whatsapp"></i> 1. R√©server & Envoyer preuve
                </button>
            </div>

            <div id="step-2-paiement" style="display:none; margin-top:30px; border-top:2px dashed #ccc; padding-top:20px;">
                <h3 style="color:var(--primary-dark);"><i class="fas fa-money-bill-wave"></i> 2. Finaliser le Paiement</h3>
                
                <div class="payment-section" style="background:#f8f9fa; padding:25px; border-radius:12px; border:1px solid #ddd;">
                    <label style="font-weight:bold;">Mode de paiement</label>
                    <select id="pay-method" onchange="togglePaymentFields()" style="background:white;">
                        <option value="">-- Choisir --</option>
                        <option value="mvola">Mobile Money (Mvola)</option>
                        <option value="espece">Esp√®ces (Agence)</option>
                    </select>

                    <div id="fields-mvola" style="display:none; margin-top:10px;">
                        <input type="text" id="pay-mvola-nom" placeholder="Nom du titulaire Mvola">
                        <input type="tel" id="pay-mvola-num" placeholder="034 XX XXX XX">
                        <input type="text" id="pay-mvola-ref" placeholder="R√©f√©rence Transaction (SMS)">
                    </div>
                    <div id="fields-espece" style="display:none; margin-top:10px;">
                        <input type="text" id="pay-cash-nom" placeholder="Nom du d√©posant">
                    </div>
                    
                    <div id="fields-montant" style="display:none; margin-top:10px;">
                        <label>Montant pay√© :</label>
                        <select id="pay-choix-montant" onchange="toggleAutreMontant()">
                            <option value="50">Acompte (50%)</option>
                            <option value="100">Totalit√© (100%)</option>
                            <option value="autre">Autre montant</option>
                        </select>
                        <div id="field-autre-montant" style="display:none; margin-top:10px;">
                            <input type="number" id="pay-valeur-autre" placeholder="Montant en Ar">
                        </div>
                    </div>

                    <button onclick="envoyerInfosPaiement()" class="btn-dark" style="width:100%; margin-top:15px; background:#27ae60;">
                        <i class="fas fa-check-circle"></i> Paiement Effectu√©
                    </button>
                </div>
            </div>

            <div id="step-3-download" style="display:none; text-align:center; margin-top:30px; background:#eafaf1; padding:20px; border-radius:10px;">
                <h3 style="color:#27ae60;">Dossier en cours de validation...</h3>
                <p>L'administrateur v√©rifie votre paiement. Cette page se mettra √† jour automatiquement.</p>
                <div class="otp-loader"><div class="spinner"></div> En attente du code OTP Admin...</div>
                <div style="margin-top:20px;">
                    <input type="text" id="input-otp-auto" placeholder="Code OTP..." readonly style="text-align:center; font-size:1.5rem; letter-spacing:5px; width:200px; background:#eee;">
                    <br>
                    <button id="btn-dl-pdf" onclick="telechargerFactureAuto()" class="btn-dark" disabled style="background:#95a5a6; cursor:not-allowed; margin-top:10px;">
                        <i class="fas fa-file-pdf"></i> T√©l√©charger Facture
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section id="divertissement" class="page-section" style="display:none;">
        <h2 class="section-title">Ambiance √† bord</h2>
        <div id="pub-media_top" class="ad-container"></div>
        <div class="media-tabs">
            <button onclick="chargerMedia('radios')" class="active-tab">üìª Radios FM</button>
            <button onclick="chargerMedia('playlists')">üéµ Playlists</button>
        </div>
        <div id="conteneur-media" class="grid-voitures"></div>
        <div id="pub-media_bot" class="ad-container"></div>
    </section>

    <section id="contact" class="page-section" style="display:none;">
        <h2 class="section-title">Contact & Avis</h2>
        <div class="contact-layout">
            <div class="form-contact-box">
                <h3>Envoyez-nous un message</h3>
                <select id="contact-sujet"><option value="Suggestion">Suggestion</option><option value="Partenariat">Partenariat</option><option value="Devis">Devis</option><option value="Autre">Autre</option></select>
                <input type="text" id="contact-nom" placeholder="Votre Nom">
                <textarea id="contact-message" rows="5" placeholder="Votre message..."></textarea>
                <button onclick="envoyerContactWhatsApp()" class="btn-whatsapp"><i class="fab fa-whatsapp"></i> Discuter sur WhatsApp</button>
            </div>
            <div class="avis-box">
                <h3>Avis Clients</h3>
                <div id="liste-avis" style="margin-bottom:20px;"></div>
                <hr>
                <h3>Votre avis compte</h3>
                <input type="text" id="avis-nom" placeholder="Votre Nom">
                <select id="avis-note"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option><option value="3">‚≠ê‚≠ê‚≠ê</option><option value="2">‚≠ê‚≠ê</option><option value="1">‚≠ê</option></select>
                <textarea id="avis-commentaire" placeholder="Votre exp√©rience..."></textarea>
                <button onclick="envoyerAvis()" class="btn-dark">Publier</button>
            </div>
        </div>
    </section>

</main>

<footer class="site-footer">
    <div class="footer-content">
        <h3 id="footer-title">Rija NIAINA Car Services</h3>
        <p><i class="fas fa-map-marker-alt"></i> <span id="footer-address">...</span></p>
        <p class="footer-legal">NIF: <span id="footer-nif">...</span> | STAT: <span id="footer-stat">...</span></p>
        <p class="footer-phone"><i class="fas fa-phone"></i> <span id="footer-phone">...</span></p>
        
        <div id="footer-socials" style="margin-top: 15px;"></div>
        
        <div id="footer-map" style="margin-top:20px;">
            </div>
    </div>
</footer>

<div id="modal-conditions" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close-modal" onclick="fermerModalConditions()">√ó</span>
        <h3><i class="fas fa-file-contract"></i> Conditions G√©n√©rales</h3>
        <p style="text-align:center; margin-bottom:20px;">Cliquez sur une carte pour voir les d√©tails</p>
        
        <div id="container-conditions-cards" class="conditions-grid">
            </div>

        <button onclick="fermerModalConditions()" class="btn-dark" style="width:100%;">Fermer</button>
    </div>
</div>

</body>
</html>