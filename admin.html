<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin · Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style-admin.css">
  <style>
    .grid-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; }
    .car-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .status-dispo { border-top: 5px solid #2ecc71; } .status-louee { border-top: 5px solid #e74c3c; } .status-maintenance { border-top: 5px solid #f39c12; }
    .badge { padding: 5px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; color: white; }
    .bg-green { background: #2ecc71; } .bg-red { background: #e74c3c; } .bg-orange { background: #f39c12; }
    .card-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>
<div id="admin-content">
  <header>
    <div>
      <h2>Dashboard Principal</h2>
      <p>Vue d'ensemble de la flotte</p>
    </div>
    <div class="header-user">
      <span id="user-email"></span>
      <span class="user-role-badge" id="user-role"></span>
      <button class="btn-logout" id="btn-logout">Déconnexion</button>
    </div>
  </header>

  <main>
    <nav>
      <button class="tab-btn active"><i class="fas fa-tachometer-alt"></i>Dashboard</button>
      <!-- Ce bouton redirige maintenant vers la page des réservations -->
      <button class="tab-btn" onclick="window.location.href='admin-reservations.html'"><i class="fas fa-calendar-check"></i>Réservations</button>
      <button class="tab-btn" onclick="alert('Page non implémentée')">Maintenance</button>
      <button class="tab-btn" onclick="alert('Page non implémentée')">Partenaires</button>
    </nav>

    <section class="content-area">
      <h3><i class="fas fa-car"></i> État de la flotte</h3>
      <div class="grid-dashboard" id="grid-voitures">
        <p>Chargement du tableau de bord...</p>
      </div>
    </section>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- Note : vous aurez besoin d'un fichier admin.js pour cette page, qui gère l'authentification et le dashboard des voitures -->
<script>
    // Script minimal pour la page principale
    document.addEventListener('DOMContentLoaded', async () => {
        const supabaseClient = supabase.createClient('https://ctijwjcjmbfmfhzwbguk.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0aWp3amNqbWJmbWZoendiZ3VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzEyOTgsImV4cCI6MjA4MTQwNzI5OH0.gEPvDc0lgf1o1Ol5AJFDPFG8Oh5SIbsZvg-8KTB4utk');
        
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (!session) { window.location.href = 'login.html'; return; }

        document.getElementById('user-email').textContent = session.user.email;
        document.getElementById('user-role').textContent = (session.user.user_metadata?.role || 'admin').toUpperCase();
        document.getElementById('btn-logout').addEventListener('click', async () => {
            await supabaseClient.auth.signOut();
            window.location.href = 'login.html';
        });

        // Charger le dashboard des voitures
        const { data: voitures } = await supabaseClient.from('voitures').select('*');
        const container = document.getElementById('grid-voitures');
        container.innerHTML = '';
        voitures.forEach(v => {
            container.innerHTML += `<div class="car-card status-dispo"><div class="card-header"><strong>${v.nom}</strong><span class="badge bg-green">Dispo</span></div></div>`;
        });
    });
</script>
</body>
</html>
