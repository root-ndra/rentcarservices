<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Espace Partenaire - RentCarServices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { margin:0; font-family:'Montserrat',sans-serif; background:#f4f6f8; }
    #login-screen { min-height:100vh; display:flex; align-items:center; justify-content:center; background:#1f2933; color:white; }
    .login-card { width:340px; background:#2f3b47; border-radius:12px; padding:30px; box-shadow:0 20px 50px rgba(0,0,0,.4); }
    .login-card h2 { margin:0; text-align:center; color:#ecf0f1; }
    .login-card label { display:block; margin-top:15px; font-weight:600; }
    .login-card input { width:100%; padding:10px; border-radius:8px; border:none; margin-top:5px; background:#1f2933; color:white; }
    .login-card button { width:100%; padding:12px; margin-top:20px; border:none; border-radius:8px; background:linear-gradient(130deg,#1abc9c,#16a085); color:white; font-weight:600; cursor:pointer; }
    #login-error { color:#ff6b6b; margin-top:10px; display:none; }

    #partner-content { display:none; min-height:100vh; }
    header { display:flex; align-items:center; justify-content:space-between; background:white; padding:15px 30px; border-bottom:1px solid #ddd; }
    .header-info h1 { margin:0; font-size:1.4rem; color:#34495e; }
    #header-user-role { padding:4px 12px; border-radius:999px; background:#7f8c8d; color:white; font-size:.75rem; }
    .btn-logout { padding:8px 14px; border:none; border-radius:6px; background:#e74c3c; color:white; cursor:pointer; }

    main { display:flex; min-height:calc(100vh - 70px); }
    nav { width:210px; background:#111827; color:white; padding:20px 0; }
    .tab-btn { width:100%; border:none; background:none; padding:14px 25px; color:#cbd5f5; text-align:left; font-weight:600; cursor:pointer; display:flex; gap:10px; align-items:center; }
    .tab-btn.active, .tab-btn:hover { background:#1f2937; color:white; }

    .content-area { flex:1; padding:30px; overflow-y:auto; }
    .tab-view { display:none; }
    .tab-view h2 { margin-top:0; color:#2c3e50; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; }
    .car-card { background:white; padding:20px; border-radius:14px; box-shadow:0 10px 25px rgba(0,0,0,.08); border-top:5px solid #1abc9c; }
    .car-card .meta { display:flex; flex-wrap:wrap; gap:8px; color:#7f8c8d; font-size:.9rem; }
    .car-card .actions { display:flex; gap:10px; }
    .btn-action { padding:8px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
    .btn-primaire { background:#1abc9c; color:white; }
    .btn-sec { background:#ecf0f1; color:#2c3e50; }

    table { width:100%; border-collapse:collapse; background:white; border-radius:14px; box-shadow:0 15px 30px rgba(0,0,0,.08); }
    table th, table td { padding:12px 14px; border-bottom:1px solid #f2f2f2; font-size:.95rem; color:#2c3e50; }
    table th { background:#f8fafc; text-transform:uppercase; font-size:.8rem; }

    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal-content { width:min(540px,90vw); background:white; border-radius:14px; padding:25px; max-height:90vh; overflow-y:auto; position:relative; }
    .close-modal { position:absolute; top:12px; right:16px; font-size:1.4rem; cursor:pointer; }
    .modal-content label { display:block; margin-top:12px; font-weight:600; color:#2c3e50; }
    .modal-content input, .modal-content select, .modal-content textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #dfe6e9; margin-top:5px; }
    .btn-full { width:100%; padding:12px; border:none; border-radius:10px; background:#1abc9c; color:white; font-weight:600; margin-top:20px; cursor:pointer; }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <section id="login-screen">
    <div class="login-card">
      <h2>Espace Partenaire</h2>
      <label>Email</label>
      <input type="email" id="partner-email" placeholder="partenaire@example.com">
      <label>Mot de passe</label>
      <input type="password" id="partner-pass" placeholder="••••••••">
      <p id="login-error"></p>
      <button onclick="loginPartenaire()">Se connecter</button>
    </div>
  </section>

  <!-- CONTENT -->
  <section id="partner-content">
    <header>
      <div>
        <h1>Tableau de bord partenaire</h1>
        <p id="partner-subtext">Suivi de vos véhicules et réservations</p>
      </div>
      <div style="display:flex; gap:12px; align-items:center;">
        <div>
          <div id="header-partner-name">user@mail.com</div>
          <div id="header-user-role">PARTENAIRE</div>
        </div>
        <button class="btn-logout" onclick="logoutPartenaire()"><i class="fas fa-power-off"></i> Quitter</button>
      </div>
    </header>

    <main>
      <nav>
        <button id="btn-tab-dashboard" class="tab-btn active" onclick="switchTabPartner('dashboard', event)">
          <i class="fas fa-chart-line"></i> Tableau de bord
        </button>
        <button id="btn-tab-reservations" class="tab-btn" onclick="switchTabPartner('reservations', event)">
          <i class="fas fa-calendar-check"></i> Réservations
        </button>
        <button id="btn-tab-maintenances" class="tab-btn" onclick="switchTabPartner('maintenances', event)">
          <i class="fas fa-tools"></i> Maintenances
        </button>
      </nav>

      <section class="content-area">

        <!-- DASHBOARD -->
        <section id="view-dashboard" class="tab-view" style="display:block;">
          <div class="top-actions" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2>Vos véhicules</h2>
            <button class="btn-action btn-sec" onclick="ouvrirModalVoiturePartner()">+ Créer un véhicule</button>
          </div>
          <div class="card-grid" id="grid-voitures"></div>
        </section>

        <!-- RESERVATIONS -->
        <section id="view-reservations" class="tab-view">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2>Réservations</h2>
            <button class="btn-action btn-primaire" onclick="toggleNewResaForm()">+ Ajouter</button>
          </div>
          <div id="form-new-resa" style="display:none; background:white; padding:20px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,.08); margin-bottom:20px;">
            <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:15px;">
              <div><label>Voiture</label><select id="new-resa-voiture" onchange="calculerPrixAdmin()"></select></div>
              <div><label>Nom client</label><input id="new-resa-nom"></div>
              <div><label>Téléphone</label><input id="new-resa-tel"></div>
              <div><label>Début</label><input type="date" id="new-resa-debut" onchange="calculerPrixAdmin()"></div>
              <div><label>Fin</label><input type="date" id="new-resa-fin" onchange="calculerPrixAdmin()"></div>
              <div><label>Montant total</label><input type="number" id="new-resa-montant" oninput="updateResteAdmin()"></div>
              <div><label>Payé</label><input type="number" id="new-resa-paye" oninput="updateResteAdmin()"></div>
              <div><label>Reste</label><input type="number" id="new-resa-reste" readonly></div>
              <div><label>Statut</label>
                <select id="new-resa-statut">
                  <option value="en_attente">En attente</option>
                  <option value="valide">Validé</option>
                  <option value="annule">Annulé</option>
                </select>
              </div>
            </div>
            <button class="btn-full" onclick="creerReservationAdmin()">Enregistrer</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Client</th>
                <th>Voiture</th>
                <th>Logistique</th>
                <th>Montants</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tbody-resa-full">
              <tr><td colspan="7">Aucune réservation</td></tr>
            </tbody>
          </table>
        </section>

        <!-- MAINTENANCES -->
        <section id="view-maintenances" class="tab-view">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2>Maintenances</h2>
            <button class="btn-action btn-sec" onclick="ouvrirModalMaintenance()">+ Maintenance</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Période</th>
                <th>Voiture</th>
                <th>Type</th>
                <th>Détails</th>
                <th>Coût</th>
              </tr>
            </thead>
            <tbody id="tbody-maint-global">
              <tr><td colspan="5">Aucune maintenance</td></tr>
            </tbody>
          </table>
        </section>

      </section>
    </main>
  </section>

  <!-- MODAL VOITURE -->
  <div class="modal-overlay" id="modal-voiture">
    <div class="modal-content">
      <span class="close-modal" onclick="fermerModal('modal-voiture')">&times;</span>
      <h2>Voiture</h2>
      <label>Nom</label><input id="new-car-nom">
      <label>Prix (Ar/j)</label><input type="number" id="new-car-prix">
      <label>Places</label><input type="number" id="new-car-places">
      <label>Transmission</label>
      <select id="new-car-trans">
        <option value="Manuelle">Manuelle</option>
        <option value="Automatique">Automatique</option>
      </select>
      <label>Carburant</label>
      <select id="new-car-carburant">
        <option value="Essence">Essence</option>
        <option value="Diesel">Diesel</option>
      </select>
      <label>Description</label><textarea id="new-car-desc" rows="3"></textarea>
      <label>Image URL</label><input id="new-car-img">
      <label>Référence</label><input id="new-car-ref">
      <button class="btn-full" onclick="ajouterVoiture()">Sauvegarder</button>
    </div>
  </div>

  <!-- MODAL MAINTENANCE -->
  <div class="modal-overlay" id="modal-maintenance">
    <div class="modal-content">
      <span class="close-modal" onclick="fermerModal('modal-maintenance')">&times;</span>
      <h2>Maintenance</h2>
      <input type="hidden" id="maint-voiture-id">
      <label>Voiture</label>
      <select id="maint-voiture-select"></select>
      <label>Catégorie</label>
      <select id="maint-cat"></select>
      <label>Sous-catégorie</label>
      <select id="maint-subcat"></select>
      <label>Motif</label>
      <select id="maint-motif"></select>
      <label>Commentaire</label>
      <textarea id="maint-commentaire" rows="2"></textarea>
      <label>Coût (Ar)</label>
      <input type="number" id="maint-cout">
      <label>Début</label>
      <input type="date" id="maint-debut">
      <label>Fin</label>
      <input type="date" id="maint-fin">
      <button class="btn-full" onclick="ajouterMaintenance()">Enregistrer</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="partenaires.js"></script>
</body>
</html>
